#!/bin/bash

# Update and install rsyslog if not installed
sudo apt update
sudo apt install -y rsyslog

# Enable and start the rsyslog service
sudo systemctl enable rsyslog
sudo systemctl start rsyslog

# Edit rsyslog configuration to forward logs
sudo bash -c 'cat << EOF >> /etc/rsyslog.conf
# Load TCP module and listen for incoming logs on TCP
module(load="imtcp") # Provides TCP syslog reception
input(type="imtcp" port="5145")

# Forward all logs to SIEM at 192.168.1.100:5145 over TCP
*.* action(type="omfwd" Target="192.168.1.100" Port="5145" Protocol="tcp" TCP_Framing="octet-counted")
EOF'

# Restart rsyslog to apply changes
sudo systemctl restart rsyslog

# Verify rsyslog is active and running
sudo systemctl status rsyslog

# Optionally, check if logs are being forwarded by monitoring traffic
# sudo tcpdump -i any host 192.168.1.100 and port 5145
